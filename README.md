# waldoapp/gh-action-upload

This GitHub Action uploads your build (`.app`, `.ipa`, or `.apk`) to Waldo.

You must specify at least a build path and a Waldo upload token.

Typically the build path is generated by a previous build action in your
workflow.

Each application registered in Waldo is associated with a unique upload token.
You can find the upload token for your app by going to the Documentation screen
for your app in [Waldo](https://app.waldo.io/). This token _should_ be
specified as a _secret_ environment variable.

## Inputs

- `build_path`

  The path to your `.app`, `.ipa`, or `.apk` build. Typically the build path is
  generated by a previous build action in your workflow. **Required.**

- `upload_token`

  The upload token associated with your app. Each application registered in
  Waldo is associated with a unique upload token. **Required.**

- `variant_name`

  An optional variant name. This is an arbitrary string to associate with this
  build.

- `git_commit`

  The originating git commit hash. This is the hash of the originating git
  commit (also known as the “git SHA”) for this build. If omitted, Waldo
  attempts to infer the git commit from the CI provider (if any) or from the
  current git repository (if accessible).

- `git_branch`

  The originating git commit branch name. This is the branch name (if any) of
  the originating git commit for this build. If omitted, Waldo attempts to
  infer the git branch name from the CI provider (if any) or from the current
  git repository (if accessible).

- `is_debug_mode`

  If this mode is enabled, additional debug information is printed. (Default:
  `false`.)

## Outputs

- `build_id`

  A unique identifier for the build that you just uploaded. Empty if the upload
  failed.

## Usage

```yaml
steps:
  - name: Checkout repo
    uses: actions/checkout@v4
  - name: Build app with Xcode
    run: |
      DERIVED_DATA_PATH=/tmp/YourApp-$(uuidgen)

      xcodebuild -project YourApp.xcodeproj             \
                 -scheme YourApp                        \
                 -configuration Release                 \
                 -sdk iphonesimulator                   \
                 -derivedDataPath "$DERIVED_DATA_PATH"  \
                 build

      echo "APP_DIR_PATH=${DERIVED_DATA_PATH}/Build/Products/Release-iphonesimulator/YourApp.app" >> "$GITHUB_ENV"
  - name: Upload resulting build to Waldo
    uses: waldoapp/gh-action-upload@v1
    with:
      build_path: ${{ env.APP_DIR_PATH }}
      upload_token: ${{ secrets.WALDO_CI_TOKEN }}
```
